<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self';">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    <title>ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ - ç‹©çŒŸå…è¨±è©¦é¨“ã‚¢ãƒ—ãƒª</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            padding: 40px;
            max-width: 900px;
            margin: 0 auto;
            background: #f5f5f5;
        }
        .result-card {
            background: white;
            padding: 30px;
            margin: 20px 0;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .metric {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        .metric:last-child {
            border-bottom: none;
        }
        .metric-name {
            font-weight: 600;
            color: #333;
        }
        .metric-value {
            font-family: monospace;
            color: #2e7d32;
        }
        .good { color: #27ae60; }
        .warning { color: #f39c12; }
        .error { color: #e74c3c; }
        button {
            background: #2e7d32;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #1b5e20;
        }
    </style>
</head>
<body>
    <h1>ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</h1>
    <p>ã“ã®ãƒšãƒ¼ã‚¸ã¯ã€ã‚¢ãƒ—ãƒªã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æ¸¬å®šã—ã¾ã™ã€‚</p>

    <div class="result-card">
        <h2>è‡ªå‹•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</h2>
        <button onclick="runAllTests()">å…¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ</button>
        <button onclick="testDataLoading()">ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testMemoryUsage()">ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãƒ†ã‚¹ãƒˆ</button>
    </div>

    <div id="results"></div>

    <script>
        const results = document.getElementById('results');

        async function runAllTests() {
            results.innerHTML = '<p>ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...</p>';

            await testPageLoad();
            await testDataLoading();
            await testMemoryUsage();
            await testLocalStorage();

            results.innerHTML += '<div class="result-card"><h3>âœ… å…¨ãƒ†ã‚¹ãƒˆå®Œäº†</h3></div>';
        }

        async function testPageLoad() {
            const card = document.createElement('div');
            card.className = 'result-card';
            card.innerHTML = '<h3>ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</h3>';

            if ('performance' in window) {
                const perfData = performance.getEntriesByType('navigation')[0];

                card.innerHTML += `
                    <div class="metric">
                        <span class="metric-name">DOMèª­ã¿è¾¼ã¿æ™‚é–“</span>
                        <span class="metric-value ${perfData.domContentLoadedEventEnd < 1000 ? 'good' : 'warning'}">
                            ${Math.round(perfData.domContentLoadedEventEnd)}ms
                        </span>
                    </div>
                    <div class="metric">
                        <span class="metric-name">å®Œå…¨èª­ã¿è¾¼ã¿æ™‚é–“</span>
                        <span class="metric-value ${perfData.loadEventEnd < 2000 ? 'good' : 'warning'}">
                            ${Math.round(perfData.loadEventEnd)}ms
                        </span>
                    </div>
                    <div class="metric">
                        <span class="metric-name">è»¢é€ã‚µã‚¤ã‚º</span>
                        <span class="metric-value">
                            ${Math.round(perfData.transferSize / 1024)}KB
                        </span>
                    </div>
                `;
            } else {
                card.innerHTML += '<p>Performance APIãŒåˆ©ç”¨ã§ãã¾ã›ã‚“</p>';
            }

            results.appendChild(card);
        }

        async function testDataLoading() {
            const card = document.createElement('div');
            card.className = 'result-card';
            card.innerHTML = '<h3>ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ</h3>';

            const startTime = performance.now();

            try {
                // quiz-database.jsonã‚’èª­ã¿è¾¼ã¿
                const quizResponse = await fetch('../quiz-database.json');
                const quizData = await quizResponse.json();

                const quizLoadTime = performance.now() - startTime;

                // hunting-license-data.jsonã‚’èª­ã¿è¾¼ã¿
                const huntingStart = performance.now();
                const huntingResponse = await fetch('../hunting-license-data.json');
                const huntingData = await huntingResponse.json();
                const huntingLoadTime = performance.now() - huntingStart;

                card.innerHTML += `
                    <div class="metric">
                        <span class="metric-name">quiz-database.json</span>
                        <span class="metric-value ${quizLoadTime < 100 ? 'good' : 'warning'}">
                            ${Math.round(quizLoadTime)}ms (${quizData.quizzes.length}å•)
                        </span>
                    </div>
                    <div class="metric">
                        <span class="metric-name">hunting-license-data.json</span>
                        <span class="metric-value ${huntingLoadTime < 100 ? 'good' : 'warning'}">
                            ${Math.round(huntingLoadTime)}ms
                        </span>
                    </div>
                    <div class="metric">
                        <span class="metric-name">åˆè¨ˆèª­ã¿è¾¼ã¿æ™‚é–“</span>
                        <span class="metric-value ${quizLoadTime + huntingLoadTime < 200 ? 'good' : 'warning'}">
                            ${Math.round(quizLoadTime + huntingLoadTime)}ms
                        </span>
                    </div>
                `;
            } catch (error) {
                card.innerHTML += `<p class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</p>`;
            }

            results.appendChild(card);
        }

        async function testMemoryUsage() {
            const card = document.createElement('div');
            card.className = 'result-card';
            card.innerHTML = '<h3>ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡</h3>';

            if ('memory' in performance) {
                const memory = performance.memory;
                const usedMB = (memory.usedJSHeapSize / 1024 / 1024).toFixed(2);
                const totalMB = (memory.totalJSHeapSize / 1024 / 1024).toFixed(2);
                const limitMB = (memory.jsHeapSizeLimit / 1024 / 1024).toFixed(2);

                card.innerHTML += `
                    <div class="metric">
                        <span class="metric-name">ä½¿ç”¨ä¸­ãƒ¡ãƒ¢ãƒª</span>
                        <span class="metric-value ${usedMB < 50 ? 'good' : 'warning'}">
                            ${usedMB} MB
                        </span>
                    </div>
                    <div class="metric">
                        <span class="metric-name">å‰²ã‚Šå½“ã¦æ¸ˆã¿ãƒ¡ãƒ¢ãƒª</span>
                        <span class="metric-value">${totalMB} MB</span>
                    </div>
                    <div class="metric">
                        <span class="metric-name">ãƒ¡ãƒ¢ãƒªä¸Šé™</span>
                        <span class="metric-value">${limitMB} MB</span>
                    </div>
                    <div class="metric">
                        <span class="metric-name">ä½¿ç”¨ç‡</span>
                        <span class="metric-value ${(usedMB / limitMB * 100) < 50 ? 'good' : 'warning'}">
                            ${((usedMB / limitMB) * 100).toFixed(1)}%
                        </span>
                    </div>
                `;
            } else {
                card.innerHTML += '<p>Memory APIãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ï¼ˆChromeã®ã¿å¯¾å¿œï¼‰</p>';
            }

            results.appendChild(card);
        }

        async function testLocalStorage() {
            const card = document.createElement('div');
            card.className = 'result-card';
            card.innerHTML = '<h3>LocalStorage</h3>';

            try {
                // ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºã‚’è¨ˆç®—
                let totalSize = 0;
                for (let key in localStorage) {
                    if (localStorage.hasOwnProperty(key)) {
                        totalSize += localStorage[key].length + key.length;
                    }
                }

                const sizeKB = (totalSize / 1024).toFixed(2);
                const limitKB = 5120; // ç´„5MB

                card.innerHTML += `
                    <div class="metric">
                        <span class="metric-name">ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º</span>
                        <span class="metric-value ${sizeKB < 1000 ? 'good' : 'warning'}">
                            ${sizeKB} KB
                        </span>
                    </div>
                    <div class="metric">
                        <span class="metric-name">ä½¿ç”¨ç‡</span>
                        <span class="metric-value ${(sizeKB / limitKB * 100) < 50 ? 'good' : 'warning'}">
                            ${((sizeKB / limitKB) * 100).toFixed(1)}%
                        </span>
                    </div>
                    <div class="metric">
                        <span class="metric-name">ä¿å­˜ã‚¢ã‚¤ãƒ†ãƒ æ•°</span>
                        <span class="metric-value">${Object.keys(localStorage).length}</span>
                    </div>
                `;

                // ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‚­ãƒ¼ä¸€è¦§
                const keys = Object.keys(localStorage).filter(key =>
                    key.includes('hunting') || key.includes('game') || key.includes('week')
                );

                if (keys.length > 0) {
                    card.innerHTML += '<h4 style="margin-top: 20px;">ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿:</h4>';
                    keys.forEach(key => {
                        card.innerHTML += `<div class="metric"><span>${key}</span></div>`;
                    });
                }

            } catch (error) {
                card.innerHTML += `<p class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</p>`;
            }

            results.appendChild(card);
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•å®Ÿè¡Œ
        window.addEventListener('load', () => {
            console.log('ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†');
        });
    </script>
</body>
</html>
