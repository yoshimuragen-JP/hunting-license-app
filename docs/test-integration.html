<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self';">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    <title>çµ±åˆãƒ†ã‚¹ãƒˆ - ç‹©çŒŸå…è¨±è©¦é¨“</title>

    <link rel="stylesheet" href="design-system.css">
    <script src="js/integration.js" defer></script>
    <script src="js/data-validator.js" defer></script>

    <style>
        body {
            font-family: 'Hiragino Kaku Gothic ProN', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .test-section {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .test-section h2 {
            color: #667eea;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #667eea;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .test-button {
            padding: 1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
        }

        .test-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .test-button.secondary {
            background: #6c757d;
        }

        .test-result {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
        }

        .test-result.success {
            border-color: #28a745;
            background: #d4edda;
        }

        .test-result.error {
            border-color: #dc3545;
            background: #f8d7da;
        }

        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }

        .status-badge.success {
            background: #28a745;
            color: white;
        }

        .status-badge.error {
            background: #dc3545;
            color: white;
        }

        .status-badge.info {
            background: #17a2b8;
            color: white;
        }
    </style>
</head>
<body>
    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <div id="navigation-placeholder"></div>

    <div class="container">
        <h1 style="text-align: center; color: #667eea; margin: 2rem 0;">ğŸ§ª çµ±åˆãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸</h1>

        <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h2>1. ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h2>
            <p>å„ãƒšãƒ¼ã‚¸ã¸ã®ãƒªãƒ³ã‚¯ãŒæ­£ã—ãæ©Ÿèƒ½ã™ã‚‹ã‹ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚</p>

            <div class="test-grid">
                <button class="test-button" onclick="AppIntegration.navigation.toHome()">
                    ğŸ  ãƒ›ãƒ¼ãƒ ã¸
                </button>
                <button class="test-button" onclick="AppIntegration.navigation.toGame()">
                    ğŸ“š å­¦ç¿’ã¸
                </button>
                <button class="test-button" onclick="AppIntegration.navigation.toMockExam()">
                    ğŸ¯ æ¨¡æ“¬è©¦é¨“ã¸
                </button>
                <button class="test-button" onclick="AppIntegration.navigation.toAnimals()">
                    ğŸ¦Œ é³¥ç£å›³é‘‘ã¸
                </button>
                <button class="test-button" onclick="AppIntegration.navigation.toPractical()">
                    ğŸ”§ å®ŸæŠ€ã‚¬ã‚¤ãƒ‰ã¸
                </button>
                <button class="test-button" onclick="AppIntegration.navigation.toDashboard()">
                    ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸
                </button>
                <button class="test-button" onclick="AppIntegration.navigation.toGuide()">
                    ğŸ“– å­¦ç¿’ã‚¬ã‚¤ãƒ‰ã¸
                </button>
            </div>

            <div class="test-grid" style="margin-top: 1rem;">
                <button class="test-button secondary" onclick="AppIntegration.navigation.toGame('æ³•ä»¤')">
                    ğŸ“œ æ³•ä»¤ã‚«ãƒ†ã‚´ãƒªã¸
                </button>
                <button class="test-button secondary" onclick="AppIntegration.navigation.toAnimals('magamo')">
                    ğŸ¦† ãƒã‚¬ãƒ¢ã®è©³ç´°ã¸
                </button>
            </div>
        </div>

        <!-- ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h2>2. ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆ</h2>
            <p>LocalStorageã¸ã®ãƒ‡ãƒ¼ã‚¿ä¿å­˜ãƒ»å–å¾—ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚</p>

            <div class="test-grid">
                <button class="test-button" onclick="testSaveProgress()">
                    ğŸ’¾ å­¦ç¿’é€²æ—ã‚’ä¿å­˜
                </button>
                <button class="test-button" onclick="testLoadProgress()">
                    ğŸ“‚ å­¦ç¿’é€²æ—ã‚’èª­è¾¼
                </button>
                <button class="test-button" onclick="testSaveResult()">
                    ğŸ’¾ æ¨¡æ“¬è©¦é¨“çµæœã‚’ä¿å­˜
                </button>
                <button class="test-button" onclick="testLoadResults()">
                    ğŸ“‚ æ¨¡æ“¬è©¦é¨“çµæœã‚’èª­è¾¼
                </button>
                <button class="test-button secondary" onclick="testClearData()">
                    ğŸ—‘ï¸ ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
                </button>
            </div>

            <div id="storage-result" class="test-result" style="display: none;"></div>
        </div>

        <!-- çµ±è¨ˆæƒ…å ±ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h2>3. çµ±è¨ˆæƒ…å ±ãƒ†ã‚¹ãƒˆ</h2>
            <p>å­¦ç¿’çµ±è¨ˆã®è¨ˆç®—ã¨å¼±ç‚¹æ¤œå‡ºã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚</p>

            <div class="test-grid">
                <button class="test-button" onclick="testOverallStats()">
                    ğŸ“Š ç·åˆçµ±è¨ˆã‚’è¡¨ç¤º
                </button>
                <button class="test-button" onclick="testCategoryStats()">
                    ğŸ“ˆ ã‚«ãƒ†ã‚´ãƒªåˆ¥çµ±è¨ˆã‚’è¡¨ç¤º
                </button>
                <button class="test-button" onclick="testWeakCategories()">
                    âš ï¸ å¼±ç‚¹ã‚«ãƒ†ã‚´ãƒªã‚’æ¤œå‡º
                </button>
            </div>

            <div id="stats-result" class="test-result" style="display: none;"></div>
        </div>

        <!-- ãƒªãƒ³ã‚¯ç”Ÿæˆãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h2>4. ãƒªãƒ³ã‚¯ç”Ÿæˆãƒ†ã‚¹ãƒˆ</h2>
            <p>ã‚¯ãƒ­ã‚¹ãƒªãƒ³ã‚¯ã®ç”Ÿæˆã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚</p>

            <div class="test-grid">
                <button class="test-button" onclick="testAnimalLinks()">
                    ğŸ”— é³¥ç£å›³é‘‘ãƒªãƒ³ã‚¯ç”Ÿæˆ
                </button>
                <button class="test-button" onclick="testCategoryLinks()">
                    ğŸ”— ã‚«ãƒ†ã‚´ãƒªå­¦ç¿’ãƒªãƒ³ã‚¯ç”Ÿæˆ
                </button>
                <button class="test-button" onclick="testWeakCategoryLinks()">
                    ğŸ”— å¼±ç‚¹ã‚«ãƒ†ã‚´ãƒªãƒªãƒ³ã‚¯ç”Ÿæˆ
                </button>
            </div>

            <div id="link-result" class="test-result" style="display: none;"></div>
        </div>

        <!-- ãƒ‡ãƒ¼ã‚¿ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h2>5. ãƒ‡ãƒ¼ã‚¿ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ</h2>
            <p>JSONãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚</p>

            <button class="test-button" onclick="testValidation()">
                ğŸ” ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ
            </button>

            <div id="validation-result" class="test-result" style="display: none;"></div>
        </div>

        <!-- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h2>6. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ</h2>
            <p>å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚</p>

            <button class="test-button" onclick="testComponents()">
                ğŸ”§ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒã‚§ãƒƒã‚¯
            </button>

            <div id="component-result" class="test-result" style="display: none;"></div>
        </div>
    </div>

    <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
    <div id="footer-placeholder"></div>

    <!-- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆèª­ã¿è¾¼ã¿ -->
    <script>
        // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³èª­ã¿è¾¼ã¿
        fetch('components/navigation.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('navigation-placeholder').innerHTML = html;
            })
            .catch(error => console.error('Navigation load failed:', error));

        // ãƒ•ãƒƒã‚¿ãƒ¼èª­ã¿è¾¼ã¿
        fetch('components/footer.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('footer-placeholder').innerHTML = html;
            })
            .catch(error => console.error('Footer load failed:', error));
    </script>

    <!-- ãƒ†ã‚¹ãƒˆé–¢æ•° -->
    <script>
        function showResult(elementId, content, type = 'info') {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `test-result ${type}`;
            element.textContent = content;
        }

        // ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆ
        function testSaveProgress() {
            const progress = {
                totalQuestions: 100,
                correctAnswers: 75,
                categories: {
                    'æ³•ä»¤': { total: 30, correct: 25 },
                    'é³¥ç£è­˜åˆ¥': { total: 40, correct: 28 },
                    'çŒŸå…·': { total: 30, correct: 22 }
                },
                studyTime: 5
            };

            AppIntegration.storage.saveProgress(progress);
            showResult('storage-result', 'âœ… å­¦ç¿’é€²æ—ã‚’ä¿å­˜ã—ã¾ã—ãŸ\n' + JSON.stringify(progress, null, 2), 'success');
        }

        function testLoadProgress() {
            const progress = AppIntegration.storage.getProgress();
            showResult('storage-result', 'ğŸ“‚ å­¦ç¿’é€²æ—ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ\n' + JSON.stringify(progress, null, 2), 'info');
        }

        function testSaveResult() {
            const result = {
                score: 85,
                total: 30,
                correct: 26,
                categories: {
                    'æ³•ä»¤': { correct: 9, total: 10 },
                    'é³¥ç£è­˜åˆ¥': { correct: 8, total: 10 },
                    'çŒŸå…·': { correct: 9, total: 10 }
                }
            };

            AppIntegration.storage.saveResult(result);
            showResult('storage-result', 'âœ… æ¨¡æ“¬è©¦é¨“çµæœã‚’ä¿å­˜ã—ã¾ã—ãŸ\n' + JSON.stringify(result, null, 2), 'success');
        }

        function testLoadResults() {
            const results = AppIntegration.storage.getResults();
            showResult('storage-result', `ğŸ“‚ æ¨¡æ“¬è©¦é¨“çµæœã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼ˆ${results.length}ä»¶ï¼‰\n` + JSON.stringify(results, null, 2), 'info');
        }

        function testClearData() {
            if (confirm('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) {
                localStorage.clear();
                showResult('storage-result', 'ğŸ—‘ï¸ ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'info');
            }
        }

        // çµ±è¨ˆãƒ†ã‚¹ãƒˆ
        function testOverallStats() {
            const stats = AppIntegration.stats.getOverallStats();
            showResult('stats-result', 'ğŸ“Š ç·åˆçµ±è¨ˆ\n' + JSON.stringify(stats, null, 2), 'info');
        }

        function testCategoryStats() {
            const categories = ['æ³•ä»¤', 'é³¥ç£è­˜åˆ¥', 'çŒŸå…·', 'ä¿è­·ç®¡ç†', 'å®ŸæŠ€'];
            let result = 'ğŸ“ˆ ã‚«ãƒ†ã‚´ãƒªåˆ¥çµ±è¨ˆ\n\n';

            categories.forEach(cat => {
                const stats = AppIntegration.stats.getCategoryStats(cat);
                result += `${cat}: ${stats.correct}/${stats.total} (${stats.accuracy}%)\n`;
            });

            showResult('stats-result', result, 'info');
        }

        function testWeakCategories() {
            const weakCategories = AppIntegration.stats.getWeakCategories();

            if (weakCategories.length === 0) {
                showResult('stats-result', 'âœ… å¼±ç‚¹ã‚«ãƒ†ã‚´ãƒªãªã—ï¼ˆã™ã¹ã¦70%ä»¥ä¸Šï¼‰', 'success');
            } else {
                let result = 'âš ï¸ å¼±ç‚¹ã‚«ãƒ†ã‚´ãƒªï¼ˆ70%æœªæº€ï¼‰\n\n';
                weakCategories.forEach(cat => {
                    result += `${cat.name}: ${cat.accuracy}% (${cat.total}å•)\n`;
                });
                showResult('stats-result', result, 'error');
            }
        }

        // ãƒªãƒ³ã‚¯ç”Ÿæˆãƒ†ã‚¹ãƒˆ
        function testAnimalLinks() {
            const animals = ['ãƒã‚¬ãƒ¢', 'ã‚«ãƒ«ã‚¬ãƒ¢', 'ã‚¤ãƒã‚·ã‚·', 'ãƒ‹ãƒ›ãƒ³ã‚¸ã‚«'];
            let result = 'ğŸ”— é³¥ç£å›³é‘‘ãƒªãƒ³ã‚¯\n\n';

            animals.forEach(animal => {
                const link = AppIntegration.generateLinks.toAnimalFromQuestion(animal);
                result += `${animal}: ${link}\n`;
            });

            showResult('link-result', result, 'info');
        }

        function testCategoryLinks() {
            const categories = ['æ³•ä»¤', 'é³¥ç£è­˜åˆ¥', 'çŒŸå…·'];
            let result = 'ğŸ”— ã‚«ãƒ†ã‚´ãƒªå­¦ç¿’ãƒªãƒ³ã‚¯\n\n';

            categories.forEach(cat => {
                const link = AppIntegration.generateLinks.toCategoryStudy(cat);
                result += `${cat}: ${link}\n`;
            });

            showResult('link-result', result, 'info');
        }

        function testWeakCategoryLinks() {
            const weakCategories = AppIntegration.stats.getWeakCategories();
            let result = 'ğŸ”— å¼±ç‚¹ã‚«ãƒ†ã‚´ãƒªãƒªãƒ³ã‚¯\n\n';

            if (weakCategories.length === 0) {
                result += 'å¼±ç‚¹ã‚«ãƒ†ã‚´ãƒªãªã—';
            } else {
                weakCategories.forEach(cat => {
                    const link = AppIntegration.generateLinks.toWeakCategory(cat.name);
                    result += `${cat.name} (${cat.accuracy}%): ${link}\n`;
                });
            }

            showResult('link-result', result, 'info');
        }

        // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ
        async function testValidation() {
            showResult('validation-result', 'ğŸ” ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œä¸­...', 'info');

            try {
                await DataValidator.validateAll();

                let result = 'ğŸ“Š ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³çµæœ\n\n';
                result += `ã‚¨ãƒ©ãƒ¼: ${DataValidator.errors.length}ä»¶\n`;
                result += `è­¦å‘Š: ${DataValidator.warnings.length}ä»¶\n\n`;

                if (DataValidator.errors.length > 0) {
                    result += 'ã‚¨ãƒ©ãƒ¼ä¸€è¦§:\n';
                    DataValidator.errors.forEach((err, i) => {
                        result += `${i + 1}. ${err}\n`;
                    });
                }

                if (DataValidator.warnings.length > 0) {
                    result += '\nè­¦å‘Šä¸€è¦§:\n';
                    DataValidator.warnings.forEach((warn, i) => {
                        result += `${i + 1}. ${warn}\n`;
                    });
                }

                const type = DataValidator.errors.length > 0 ? 'error' :
                            DataValidator.warnings.length > 0 ? 'info' : 'success';

                showResult('validation-result', result, type);
            } catch (error) {
                showResult('validation-result', `âŒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¤±æ•—: ${error.message}`, 'error');
            }
        }

        // ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
        function testComponents() {
            let result = 'ğŸ”§ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒã‚§ãƒƒã‚¯\n\n';

            // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
            const navPlaceholder = document.getElementById('navigation-placeholder');
            const hasNav = navPlaceholder && navPlaceholder.innerHTML.trim() !== '';
            result += `ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³: ${hasNav ? 'âœ… OK' : 'âŒ NG'}\n`;

            // ãƒ•ãƒƒã‚¿ãƒ¼
            const footerPlaceholder = document.getElementById('footer-placeholder');
            const hasFooter = footerPlaceholder && footerPlaceholder.innerHTML.trim() !== '';
            result += `ãƒ•ãƒƒã‚¿ãƒ¼: ${hasFooter ? 'âœ… OK' : 'âŒ NG'}\n`;

            // JavaScript
            const hasIntegration = typeof AppIntegration !== 'undefined';
            result += `integration.js: ${hasIntegration ? 'âœ… OK' : 'âŒ NG'}\n`;

            const hasValidator = typeof DataValidator !== 'undefined';
            result += `data-validator.js: ${hasValidator ? 'âœ… OK' : 'âŒ NG'}\n`;

            const type = (hasNav && hasFooter && hasIntegration && hasValidator) ? 'success' : 'error';
            showResult('component-result', result, type);
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•ãƒã‚§ãƒƒã‚¯
        window.addEventListener('load', () => {
            setTimeout(() => {
                testComponents();
            }, 2000);
        });
    </script>
</body>
</html>
