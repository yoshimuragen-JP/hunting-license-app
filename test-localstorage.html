<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LocalStorageçµ±ä¸€ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c5f2d;
            border-bottom: 3px solid #2c5f2d;
            padding-bottom: 10px;
        }
        button {
            background: #2c5f2d;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #1e4620;
        }
        button.danger {
            background: #dc3545;
        }
        button.danger:hover {
            background: #c82333;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            max-height: 400px;
            border: 1px solid #dee2e6;
        }
        .section {
            margin: 20px 0;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” LocalStorageçµ±ä¸€ãƒ†ã‚¹ãƒˆ</h1>

        <div class="section">
            <h2>ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿</h2>
            <button onclick="displayCurrentData()">ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º</button>
            <button onclick="checkIntegrity()">æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯</button>
            <div id="current-data"></div>
        </div>

        <div class="section">
            <h2>ãƒ†ã‚¹ãƒˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h2>
            <button onclick="simulateGamePlay()">ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ</button>
            <button onclick="simulateExam()">æ¨¡æ“¬è©¦é¨“ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ</button>
            <button onclick="simulateQuiz()">ã‚¯ã‚¤ã‚ºã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ</button>
        </div>

        <div class="section">
            <h2>ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h2>
            <button onclick="migrateOldData()">æ—§ãƒ‡ãƒ¼ã‚¿ã‚’ç§»è¡Œ</button>
            <button class="danger" onclick="clearAllData()">å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢</button>
        </div>

        <div class="section">
            <h2>ãƒ­ã‚°</h2>
            <div id="log"></div>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const statusDiv = document.createElement('div');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.insertBefore(statusDiv, logDiv.firstChild);
        }

        function displayCurrentData() {
            const huntingProgress = JSON.parse(localStorage.getItem('huntingProgress'));
            const huntingGameStats = JSON.parse(localStorage.getItem('huntingGameStats'));
            const examHistory = JSON.parse(localStorage.getItem('examHistory'));

            const display = document.getElementById('current-data');
            display.innerHTML = `
                <h3>çµ±ä¸€ãƒ‡ãƒ¼ã‚¿æ§‹é€  (huntingProgress)</h3>
                <pre>${JSON.stringify(huntingProgress, null, 2)}</pre>

                <h3>æ—§ãƒ‡ãƒ¼ã‚¿ (huntingGameStats)</h3>
                <pre>${huntingGameStats ? JSON.stringify(huntingGameStats, null, 2) : 'å­˜åœ¨ã—ã¾ã›ã‚“'}</pre>

                <h3>æ—§ãƒ‡ãƒ¼ã‚¿ (examHistory)</h3>
                <pre>${examHistory ? JSON.stringify(examHistory, null, 2) : 'å­˜åœ¨ã—ã¾ã›ã‚“'}</pre>
            `;

            log('ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ', 'success');
        }

        function checkIntegrity() {
            const progress = JSON.parse(localStorage.getItem('huntingProgress'));

            if (!progress) {
                log('âš ï¸ huntingProgressãŒå­˜åœ¨ã—ã¾ã›ã‚“', 'error');
                return;
            }

            const checks = [
                { name: 'totalQuestions', exists: typeof progress.totalQuestions === 'number' },
                { name: 'correctAnswers', exists: typeof progress.correctAnswers === 'number' },
                { name: 'categories', exists: progress.categories && typeof progress.categories === 'object' },
                { name: 'quizHistory', exists: Array.isArray(progress.quizHistory) },
                { name: 'gameStats', exists: progress.gameStats && typeof progress.gameStats === 'object' },
                { name: 'examHistory', exists: Array.isArray(progress.examHistory) }
            ];

            const allValid = checks.every(check => check.exists);

            if (allValid) {
                log('âœ… ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯: å…¨ã¦æ­£å¸¸', 'success');

                // ã‚«ãƒ†ã‚´ãƒªã®ç¢ºèª
                const requiredCategories = ['law', 'tools', 'animals', 'management', 'practical'];
                const hasAllCategories = requiredCategories.every(cat =>
                    progress.categories[cat] &&
                    typeof progress.categories[cat].correct === 'number' &&
                    typeof progress.categories[cat].total === 'number'
                );

                if (hasAllCategories) {
                    log('âœ… å…¨ã‚«ãƒ†ã‚´ãƒªãŒæ­£ã—ãå®šç¾©ã•ã‚Œã¦ã„ã¾ã™', 'success');
                } else {
                    log('âš ï¸ ä¸€éƒ¨ã®ã‚«ãƒ†ã‚´ãƒªãŒä¸è¶³ã—ã¦ã„ã¾ã™', 'warning');
                }
            } else {
                const failed = checks.filter(c => !c.exists).map(c => c.name);
                log(`âŒ ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯å¤±æ•—: ${failed.join(', ')}`, 'error');
            }
        }

        function simulateGamePlay() {
            const progress = JSON.parse(localStorage.getItem('huntingProgress')) || initProgress();

            // ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
            progress.totalQuestions += 5;
            progress.correctAnswers += 4;
            progress.studyTime += 120; // 2åˆ†
            progress.lastStudyDate = new Date().toISOString();

            // ã‚«ãƒ†ã‚´ãƒªåˆ¥é€²æ—
            progress.categories.law.total += 2;
            progress.categories.law.correct += 2;
            progress.categories.animals.total += 3;
            progress.categories.animals.correct += 2;

            // ã‚²ãƒ¼ãƒ çµ±è¨ˆ
            progress.gameStats.totalGames += 1;
            progress.gameStats.highScore = Math.max(progress.gameStats.highScore || 0, 550);
            progress.gameStats.maxCombo = Math.max(progress.gameStats.maxCombo || 0, 4);

            // å­¦ç¿’å±¥æ­´
            progress.quizHistory.push({
                date: new Date().toISOString(),
                type: 'game',
                mode: 'quickMatch',
                score: 550,
                correctCount: 4,
                totalQuestions: 5,
                timeSpent: 120,
                maxCombo: 4
            });

            localStorage.setItem('huntingProgress', JSON.stringify(progress));
            log('âœ… ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¾ã—ãŸï¼ˆ5å•ä¸­4å•æ­£è§£ï¼‰', 'success');
            displayCurrentData();
        }

        function simulateExam() {
            const progress = JSON.parse(localStorage.getItem('huntingProgress')) || initProgress();

            // æ¨¡æ“¬è©¦é¨“ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
            progress.totalQuestions += 30;
            progress.correctAnswers += 24;
            progress.studyTime += 3600; // 60åˆ†
            progress.lastStudyDate = new Date().toISOString();

            // ã‚«ãƒ†ã‚´ãƒªåˆ¥é€²æ—
            Object.keys(progress.categories).forEach(cat => {
                progress.categories[cat].total += 6;
                progress.categories[cat].correct += 5;
            });

            // è©¦é¨“å±¥æ­´
            progress.examHistory.push({
                date: new Date().toISOString(),
                score: 80,
                correctCount: 24,
                totalQuestions: 30,
                timeUsed: 3600,
                passed: true,
                categoryStats: {}
            });

            // å­¦ç¿’å±¥æ­´
            progress.quizHistory.push({
                date: new Date().toISOString(),
                type: 'exam',
                score: 80,
                correctCount: 24,
                totalQuestions: 30,
                timeSpent: 3600,
                passed: true
            });

            localStorage.setItem('huntingProgress', JSON.stringify(progress));
            log('âœ… æ¨¡æ“¬è©¦é¨“ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¾ã—ãŸï¼ˆ30å•ä¸­24å•æ­£è§£ã€åˆæ ¼ï¼‰', 'success');
            displayCurrentData();
        }

        function simulateQuiz() {
            const progress = JSON.parse(localStorage.getItem('huntingProgress')) || initProgress();

            // ã‚¯ã‚¤ã‚ºã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
            progress.totalQuestions += 10;
            progress.correctAnswers += 8;
            progress.studyTime += 300; // 5åˆ†
            progress.lastStudyDate = new Date().toISOString();

            // ã‚«ãƒ†ã‚´ãƒªåˆ¥é€²æ—
            progress.categories.tools.total += 5;
            progress.categories.tools.correct += 4;
            progress.categories.practical.total += 5;
            progress.categories.practical.correct += 4;

            // å­¦ç¿’å±¥æ­´
            progress.quizHistory.push({
                date: new Date().toISOString(),
                type: 'practice',
                score: 80,
                correctCount: 8,
                totalQuestions: 10,
                timeSpent: 300
            });

            localStorage.setItem('huntingProgress', JSON.stringify(progress));
            log('âœ… ã‚¯ã‚¤ã‚ºã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¾ã—ãŸï¼ˆ10å•ä¸­8å•æ­£è§£ï¼‰', 'success');
            displayCurrentData();
        }

        function migrateOldData() {
            const oldGameStats = JSON.parse(localStorage.getItem('huntingGameStats'));
            const oldExamHistory = JSON.parse(localStorage.getItem('examHistory'));
            const progress = JSON.parse(localStorage.getItem('huntingProgress')) || initProgress();

            let migrated = false;

            if (oldGameStats) {
                progress.gameStats = {
                    totalGames: oldGameStats.totalGames || 0,
                    highScore: oldGameStats.bestScore || 0,
                    maxCombo: oldGameStats.maxCombo || 0,
                    achievements: oldGameStats.achievements || [],
                    dailyStreak: oldGameStats.dailyStreak || 0,
                    lastPlayDate: oldGameStats.lastPlayDate || null
                };
                migrated = true;
                log('âœ… huntingGameStatsã‚’ç§»è¡Œã—ã¾ã—ãŸ', 'success');
            }

            if (oldExamHistory && oldExamHistory.length > 0) {
                progress.examHistory = oldExamHistory;
                migrated = true;
                log('âœ… examHistoryã‚’ç§»è¡Œã—ã¾ã—ãŸ', 'success');
            }

            if (migrated) {
                localStorage.setItem('huntingProgress', JSON.stringify(progress));
                log('âœ… ãƒ‡ãƒ¼ã‚¿ç§»è¡ŒãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');
                displayCurrentData();
            } else {
                log('â„¹ï¸ ç§»è¡Œã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', 'warning');
            }
        }

        function clearAllData() {
            if (confirm('æœ¬å½“ã«å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                localStorage.removeItem('huntingProgress');
                localStorage.removeItem('huntingGameStats');
                localStorage.removeItem('examHistory');
                log('ğŸ—‘ï¸ å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'warning');
                displayCurrentData();
            }
        }

        function initProgress() {
            return {
                totalQuestions: 0,
                correctAnswers: 0,
                studyTime: 0,
                lastStudyDate: null,
                categories: {
                    law: { correct: 0, total: 0 },
                    tools: { correct: 0, total: 0 },
                    animals: { correct: 0, total: 0 },
                    management: { correct: 0, total: 0 },
                    practical: { correct: 0, total: 0 }
                },
                quizHistory: [],
                gameStats: {
                    totalGames: 0,
                    highScore: 0,
                    maxCombo: 0,
                    achievements: [],
                    dailyStreak: 0,
                    lastPlayDate: null
                },
                examHistory: []
            };
        }

        // åˆæœŸè¡¨ç¤º
        displayCurrentData();
    </script>
</body>
</html>
